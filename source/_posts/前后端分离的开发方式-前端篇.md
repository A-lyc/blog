---
title: 前后端分离的开发方式-前端篇
date: 2019-11-26 09:53:05
category: web
tags:
  - 开发经验
  - vue
---

> 做项目时
> 经常有需要后端提供接口才能继续往下进行的场景
> 本文主要讨论该如何正确处理该场景情况

## 后端各类情况分析

1. 完美型: 已有成型接口
> 分析：通常为重构项目，该情况下可以直接使用已有接口进行前端开发
> 星级：★★★★★

2. 常规型：没有成型接口，前后端同时进行，约定或者没有约定数据字段
> 分析：通常为新项目，继续往下看吧
> 星级：★★★★

3. 缺陷型：没有成型接口，后端进度慢，约定或者没有约定数据字段
> 分析：通常为新项目，后端受其他项目干扰任务重等场景
> 星级：★★

4. 不知所措型：没有成型接口，后端遥遥无期，甚至迷茫
> 分析：后端极度不确定的场景，此时尽量把分内（前端）的工作做好
> 星级：★

## 分析问题
> 情况分析中 1 为理想情况，可以直接按照后端接口开发，无须特殊注意
> 主要从 2、3、4 中分析

1. 没有约定字段，导致前端不知道要用什么 key 值，导致后端接口成型后，需要重新大量修改前端
2. 部分复杂功能需要依赖后端返回值，key值 和 响应返回值不确定造成无法进行

> 总结：字段 key 值不确定！

## 解决方案

1. 切好样式后，卡住不继续进行，等后端接口成型后，根据接口再继续做
> ★★★
> 分析：劳动力最小的方案，但卡住不进行在现实中不理想，工作量 “头轻脚重”，开发不连贯，造成很多问题

2. 切好样式后，通过 mock 数据，继续绑定功能，key 值为前端定义，后期和后端商量着改
> ★★
> 分析：不推荐，会有 “沟通问题” 和 “成型差异”，“改” 可能会 “大改” 甚至 “全改”

3. 切好样式后，通过 mock 数据，继续绑定功能，定义 “前端 key 值”，不需要与后端相同，额外增加代码 loader 部分，在前端转换 key 值差异
> ★★★★★
> 分析：开发连贯，loader 的存在避免了因为 key 值的问题而大改代码，维护性较好，可以随时出一份不需要后端即可访问的静态版本

## 解决方案 3 解析
> 例子使用了 vue + vue-cli
> 开发过程为：

1. 定义 “前端字段”，模拟数据，写好功能
2. 后端接口完成，正式对接
3. 对响应数据进行处理，转化为 “前端字段” 数据
4. 完成提交等，必须有后端才能继续的功能
5. 项目需求修改，从步骤 1 重新开始，无限循环

> 具体方法

1. 定义环境变量 process.env.MOCK，代表进入 mock 环境
> 可自行查找方法，例：
> npm run dev        -> 开发模式，正式对接版本
> npm run build      -> 产品模式，正式对接版本
> npm run dev:mock   -> 开发模式，mock 版本
> npm run build:mock -> 产品模式，mock 版本

2. 分析页面所需要的字段，在 data 中定义前端 key 值，写好模板，并根据环境变量 mock 数据

```html
<template>
  <div v-if="dataArr">
    <div v-for="(item, i) in dataArr" :key="i"/>
  </div>
</template>
```
```javascript
// 是否为 mock 环境
const IS_MOCK = process.env.VUE_APP_MOCK;

export default {
  data () {
    return {
      bannerI: 0,
      title: IS_MOCK ? '标题' : null,
      dataArr: IS_MOCK ? [
        { name: 1 },
        { name: 2 }
      ] : null
    }
  },
  methods: {
    // 组件初始化方法
    async init () {
      // 待后端真实接口
      if (!IS_MOCK) {
        // 发送请求获取数据
        let dataArr = await (axios.get('...')).data
        // 转换数据
        this.dataArr = dataArr.map(() => {/****/})
      }
    }
  },
  created () {
    this.init();
  }
}
```

3. 需要请求后端获取数据的方法中，判断 MOCK 值，模拟返回值。
> 关键词搜索等功能
```javascript
const IS_MOCK = process.env.VUE_APP_MOCK;

export default {
  methods: {
    search (keywords) {
      // mock 定义前端需要的数据格式
      if (IS_MOCK) {
        return [ { text: 1 }, { text: 2 } ]
      }
      // 待后端接口完成
      // 根据上面 mock 的数据结构进行转换
      else {
        
      }
    }
  }
}
```

4. 表单提交的方法中，判断 MOCK 值，console 出请求参数，保证前端逻辑无错误，等待真实接口对接
```javascript
const IS_MOCK = process.env.VUE_APP_MOCK;

export default {
  data () {
    return {
      name: IS_MOCK ? '魏大勋' : null,
      form: {
        age: null,
        message: null
      }
    }
  },
  methods: {
    submit () {
      if (IS_MOCK) {
        console.log('-----------------------')
        console.log('提交表单数据：')
        console.log(this.form);
        console.log('-----------------------')
      }
      // 待后端接口完成
      else {
        
      }
    }
  }
}
```