---
title: 心得-无接口时如何继续前端开发
date: 2019-11-26 09:53:05
category: 前端心得
tags:
  - 经验
---

> 本文讨论：
> 前端做项目时如何优雅的对接数据接口

## 问题由来
> 大多功能都需要接口对接才能完成
> 此时若后端接口还没出来，前端如何做？

## 开发时后端各类情况分析

1. 完美型: 已有成型接口
> 分析：非常理想的开发体验，通常为重构项目等
> 方案：该情况下可以直接使用已有接口进行前端开发，无需特殊注意
> 星级：★★★★★

2. 常规型：没有成型接口，前后端同时进行
> 分析：通常为新项目
> 方案：本文着重探讨的情况，继续往下看吧
> 星级：★★★★

3. 缺陷型：没有成型接口，后端进度比前端慢，甚至慢很多，需要等待接口
> 分析：后端项目多，任务重等场景
> 方案：本文着重探讨的情况，继续往下看吧
> 星级：★★

4. 不知所措型：没有成型接口，后端遥遥无期，甚至迷茫
> 分析：后端极度不确定
> 方案：本文着重探讨的情况，继续往下看吧
> 星级：★

## “约定字段” 和 “前端字段”
> 约定字段这件事通常只是一个规范，一个好的习惯。
> 实际情况前后端可能不会去约定，也无法准确约定，总有纰漏
> 通常情况是 “各做各的”
> 然后数据通过接口返回时才知道字段名
> 好一点的会统一定义些数据模型
> 但是特殊功能，表单提交等，通常也无法保证统一定义

前后端的应用场景不同，所以有时数据结构定义的也不同
与其依赖后端的数据结构，还不如自定义前端字段完成功能
然后通过 “装载器函数（webLoader）”再将值赋值给前端字段

## 无接口时的解决方案

1. 无接口不进行
> 解释：完成基础样式后，放任项目不管，等待后端提供接口后，继续进行。
> 分析：非常适合小型无复杂功能类项目。
> 优点：劳动力最小，小项目很实用
> 缺点：中大项目不适用，开发体验不连贯，“头重，尾重，中间轻”，接口对接时需要同时兼顾前端逻辑和后端对接，导致无法专一面对问题。

2. mock 数据继续进行
> 解释：模拟一些数据，继续往下开发，有接口时，将 mock 的数据替换成真实数据
> 分析：mock 数据是 “无后端” 时的唯一办法
> 优点：开发连贯，可以在无后端的情况下，打包一份 mock 版本，保证前端任务完成
> 缺点：根据不同项目需要选择最优的 mock 方式，不健壮的 mock 会带来一定烦恼
> 注意：一定要灵活的切换 mock 和真实环境，否则导致项目频繁报错，查原因很麻烦

## 前端字段 和 mock 是必须的吗？
> “前端字段” 是一种思想
> 抛弃前后端字段统一的问题，使用 loader（装载器函数）的代价完成数据对接

> mock 数据的作用就是在无 “真实数据源” 的时候提供一个 “虚假数据源” 继续开发
> 等待有 “真实数据源” 时，再尽量 ！！无缝切换！！

> 这俩通常情况下是绑在一起的，定义 “前端字段” 的时候顺便 mock

## 来个例子
> 例子功能：数据展示，提交表单
> 项目脚手架：vue-cli
> 后端情况：进度较慢
> 推荐库：mock.js

1. 创建 mock 环境，定义环境变量 process.env.isMock
```javascript
console.log(process.env.IS_MOCK)
// => true
```

2. 切好样式，同时根据功能设计前端字段，同时 mock 数据
```html
<template>
  <div>
    <div class="article" v-for="item in dataArr" :key="item.id">
      <img :src="item.cover" alt="">
      <h3 class="title">
        {{ item.title }}
      </h3>
      <p>{{ item.desc }}</p>
    </div>
  </div>
</template>
```
```javascript
let { IS_MOCK } = process.env;

export default {
  data () {
    return {
      dataArr: IS_MOCK ? [
        { id: 0, title: '今天发生了大事情', desc: '公交车上阿萨德科技大卡司建档立卡' },
        { id: 1, title: '今天发生了大事情', desc: '公交车上阿萨德科技大卡司建档立卡' }
      ] : null
    }
  },
  methods: {
    init () {
      /** 请求数据 **/
      let apiDataArr = new Promise((resolve, reject) => {
        /** 不重要 **/
      }).then(apiDataArr => {
        /** 调用 loader 为前端字段赋值 **/
        this.loader(apiDataArr);
      })
    },
    loader (apiDataArr) {
      /***
       * 如果是 mock 环境，则使用 mock 数据
       * 写在这里的原因是尽量不要在逻辑代码中加入 IS_MOCK 判断
       * 影响代码视觉
       ***/
      if (IS_MOCK) return;
      
      /**
       *  接口字段赋值前端字段
       **/
      this.dataArr = apiDataArr.map(item => {
        return {
          id: item._id,
          /** 你永远不知道后端起的什么奇怪的名字... **/
          cover: item.p,
          title: item.t,
          desc: item.d
        }
      });
    }
  },
  created () {
    this.init();
  }
}
```