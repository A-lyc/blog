---
title: 心得-微信小程序
category: 前端心得
date: 2019-11-12 09:23:45
tags:
  - 经验
  - 酷库
---

> 记载着微信小程序的开发心得

## 框架的选择
> 若原生撸请忽略，但并不推荐
> 原生的开发体验较为差劲，解决方案少
> 现在是 2020.1.3，个人推荐 uni-app 这个框架
> 真心强大！

### uni-app
> https://github.com/dcloudio/uni-app
> 非常推荐
> 体验：完全的 vue 开发体验，支持所有 vue 语法，支持跨端，社区完善，并拥有插件平台

### wepy
> https://github.com/Tencent/wepy
> 不推荐
> 体验：类 vue 开发体验，但是区别还是比较大的，有学习成本
> 问题：使用过一段时间，问题比较多...，放弃使用的原因是 repeat 双层循环，内层循环读取不到数据，并且无解决办法

### mpvue
> https://github.com/Meituan-Dianping/mpvue
> 推荐
> 体验：不完全的 vue 开发体验，不支持 filter 等，其他基本相同，支持跨端
> 问题：据说停止维护了....

碰到的问题...
1. 使用 lodash@4.17.15，dev 正常，pro 报错，降级到 lodash@4.16.0 好了
2. prop 在 template 中传入时，要用驼峰命名，短横线命名会无效
------------------------------------------------------------------------------

## 酷库 - html 渲染方案

### rich-text 组件
> 无法主动控制样式，只能想办法改变 html 中的 style
> 非常不灵活

### wxParse
> https://github.com/icindy/wxParse
> 基于原生小程序，若没有使用小程序框架就用它吧

### mpvue-wxParse
> https://github.com/F-loat/mpvue-wxParse
> 看名字就知道是基于 mpvue 的，uni-app 也可以使

## 酷库 - 支持 cookie
> 小程序默认不支持 cookie 传输，但后端的逻辑经常会依赖 cookie
> 解决方案：https://github.com/charleslo1/weapp-cookie
> 使用起来非常方便，只需要引入即可

------------------------------------------------------------------------------

## 酷库 - 优雅的发送请求
> https://github.com/SoloJiang/axios
> wx-axios 用这个库
> 微信小程序版 axios，作者 fork 原本的 axios 实现

------------------------------------------------------------------------------

## 经验 - 分包
> 小程序有代码体积限制（小于 2m）
> 若体积过大就只能用分包的形式

> uni-app 可以强制开启代码压缩缓解在开发环境下体积过大，无法真机预览的问题

```javascript
// vue.config.js
// uni-app 强制开启代码压缩
module.exports = {
  configureWebpack (config) {
    // 防止在开发环境文件过大的情况
    config.optimization.minimize = true
  }
}
```

```
// uni-app 的分包优化配置
"mp-weixin": {
  "optimization" : {
    "subPackages" : true
  }
}
```

------------------------------------------------------------------------------

## 经验 - button 边框
> button 边框是用 :after 实现的
> 并不是 border 实现

------------------------------------------------------------------------------

## 经验 - iconfont 引入
> 小程序推荐使用 iconfont 作为部分图片的解决方案
> 因为小程序中的 image 标签，默认宽高不是真实图片大小，需要手动定义
> 替换图片时会造成一些麻烦(比如传的图片大小不一样，导致的显示不全问题)
> 使用 iconfont 即可以解决问题
> 注意：小程序不支持加载本地字体文件！但是可以加载网络字体文件

{% asset_img iconfont.jpg %}

------------------------------------------------------------------------------

## 经验 - map 组件

### 阻止手势缩放和拖动
> 官方暂不支持，但若无点击需求可以通过一个遮盖层实现

### marker 自定义文字的位置
> 2020.1.2...
> 建议放弃使用下面的想法，还是改用一张图片实现
> 经过测试有些 bug 无法解决

1. 位置太难对准
2. ios 设备上有 marker 和 label 的层叠性问题

ios 效果如下
{% asset_img map-label-center-2.jpg %}

> ~~marker callout 只能显示在 marker 的上方，位置不能改变~~
> ~~marker label 可以改变相对于 marker 的位置(大约计算)~~
> ~~但是没有 left，center，right 这种属性~~
> ~~下面例子使用 label 实现文字垂直居中对其~~

{% asset_img map-label-center-1.jpg %}

```javascript
let markerArr = [
  {
    // ... marker options ...
    label: {
      // ... label options ...
      anchorX: ('自定义文字'.length * 4.7) * -1,
      anchorY: -29
    }
  },
  // ... other marker
]
```

------------------------------------------------------------------------------

## 经验 - input change 事件不触发
> 已知基础库 2.9.3 有这个 bug
> 若出现，降级或升级试试看

------------------------------------------------------------------------------

## 填坑 - getCurrentPages
> getCurrentPages 方法返回的页面数组中 route 属性无查询字符串
> 查询字符串保存在 options 属性中(对象形式)，想要完整的需要自己拼接
> 建议使用 qs 做拼接

{% asset_img getCurrentPages-route-options.jpg %}