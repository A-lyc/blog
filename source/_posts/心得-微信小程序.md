---
title: 心得-微信小程序
category: 前端心得
date: 2019-11-12 09:23:45
tags:
  - 经验
---

> 记载着微信小程序的开发心得

## 框架的选择
> 若原生撸请忽略，但并不推荐，原生的开发体验较为差劲

### wepy
> https://github.com/Tencent/wepy
> 不推荐
> 体验：类 vue 开发体验，但是区别还是比较大的，有学习成本
> 问题：使用过一段时间，问题比较多...，放弃使用的原因是 repeat 双层循环，内层循环读取不到数据，并且无解决办法

### mpvue
> https://github.com/Meituan-Dianping/mpvue
> 推荐
> 体验：不完全的 vue 开发体验，不支持 filter 等，其他基本相同，支持跨端
> 问题：据说停止维护了....

### uni-app
> https://github.com/dcloudio/uni-app
> 非常推荐
> 体验：完全的 vue 开发体验，支持所有 vue 语法，支持跨端，社区完善，并拥有插件平台

碰到的问题...
1. 使用 lodash@4.17.15，dev 正常，pro 报错，降级到 lodash@4.16.0 好了

------------------------------------------------------------------------------

## 支持 cookie
> 小程序默认不支持 cookie 传输，但后端的逻辑经常会依赖 cookie
> 解决方案：https://github.com/charleslo1/weapp-cookie
> 使用起来非常方便，只需要引入即可

------------------------------------------------------------------------------

## button 边框
> button 边框是用 :after 实现的
> 并不是 border 实现

------------------------------------------------------------------------------

## iconfont 引入
> 小程序推荐使用 iconfont 作为部分图片的解决方案
> 因为小程序中的 image 标签，默认宽高不是真实图片大小，需要手动定义
> 替换图片时会造成一些麻烦(比如传的图片大小不一样，导致的显示不全问题)
> 使用 iconfont 即可以解决问题
> 注意：小程序不支持加载本地字体文件！但是可以加载网络字体文件

{% asset_img iconfont.jpg %}

------------------------------------------------------------------------------

## map 组件

### 阻止手势缩放和拖动
> 官方暂不支持，但若无点击需求可以通过一个遮盖层实现

### marker 自定义文字的位置
> marker callout 只能显示在 marker 的上方，位置不能改变
> marker label 可以改变相对于 marker 的位置(大约计算)，但是没有 left，center，right 这种属性
> 下面例子使用 label 实现文字垂直居中对其

{% asset_img map-label-center.jpg %}

```javascript
let markerArr = [
  {
    // ... marker options ...
    label: {
      // ... label options ...
      anchorX: ('自定义文字'.length * 4.7) * -1,
      anchorY: -29
    }
  },
  // ... other marker
]
```

------------------------------------------------------------------------------

------------------------------------------------------------------------------

## input change 事件不触发
> 已知基础库 2.9.3 有这个 bug
> 若出现，降级或升级试试看

------------------------------------------------------------------------------

## 优雅的发送请求
> https://github.com/SoloJiang/axios
> wx-axios 用这个库
> 微信小程序版 axios，作者 fork 原本的 axios 实现

------------------------------------------------------------------------------

## 分包
> 小程序有代码体积限制（小于 2m）
> 若体积过大就只能用分包的形式

> uni-app 可以强制开启代码压缩缓解在开发环境下体积过大，无法真机预览的问题

```javascript
// vue.config.js
// uni-app 强制开启代码压缩
module.exports = {
  configureWebpack (config) {
    // 防止在开发环境文件过大的情况
    config.optimization.minimize = true
  }
}
```

```
// uni-app 的分包优化配置
"mp-weixin": {
  "optimization" : {
    "subPackages" : true
  }
}
```

------------------------------------------------------------------------------